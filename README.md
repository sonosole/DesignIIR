# IIR 滤波器设计

## 简言

滤波器是能对信号的频率分量进行修正的系统，在连续系统中称之为**模拟滤波器**，例如电阻、电容与电感组成的基本电路，而在离散系统中则称之为**数字滤波器**，例如 FIR 与 IIR 滤波器。在一些存储、计算资源有限，或者实时性要求很高的场景，IIR 滤波器一般是首选，而对非线性相位失真敏感的场景则可以使用 FIR 滤波器。设计数字滤波器的方法有多种，大体思路有两类，即分别从时域、频域角度去设计。

### 频域设计法

使**数字**滤波器的系统频响 $H[z]$ 为其对应的**模拟**滤波器的系统频响 $H(s)$ 的逼近, 此法具体操作方向有：

+ $ \footnotesize 模拟低通 \xrightarrow{模拟频率变换} 模拟目标类型 \xrightarrow{变换域逼近} 数字目标类型 $
+ $ \footnotesize 模拟低通 \xrightarrow{变换域逼近} 数字低通 \xrightarrow{数字频率变换} 数字目标类型 $
+ $ \footnotesize 模拟低通 \xrightarrow{频率变换} 数字目标类型 $

一般是先设计出模拟系统函数 $H(s)$ ，再使用**域变换**的方法直接将其变换到数字系统函数 $H[z]$，常用的一种变换方法为**双线性变换法**。

### 时域设计法

使**数字**滤波器的单位脉冲响 $h[n]$ 为其对应的**模拟**滤波器的单位脉冲响应 $h_a(t)$ 的采样, 此法称为**脉冲响应不变法**。

## 双线性变换法

在频域设计法中，如果能找到将 $s$ 域转换到 $z$ 域的方法，那么便可以实现从模拟到数字的关键变换。可以尝试从模拟域中找到一个几乎只含有 $s$ 的简单变换式。例如在长期的**稳定系统**中，$s=jΩ$，考虑傅里叶变换 $ℱ$ 的积分特性，若有傅里叶变换对

$$
x(t) \xrightarrow{ℱ} X(jΩ)  \tag{1}
$$

则原函数的积分对应的傅里叶变换对为

$$
\int\limits_{-∞}^{t} x(τ) dτ \xrightarrow{ℱ} X(jΩ)(\frac{1}{jΩ} + πδ(Ω))  \tag{2}
$$

对于无直流分量的系统，即有

$$
\int\limits_{-∞}^{t} x(τ) dτ \xrightarrow{ℱ} \frac{X(jΩ)}{jΩ}  \tag{3}
$$

这在无初始状态的系统中也可以得到一致的结论（对应于拉普拉斯变换域特性）。现在只含有 $s$ 的关系式有了，而积分又如何跟离散域取得联系呢？这里容易跟微元法扯上关系，可以将积分写为

$$
y(t) = \int\limits_{-∞}^{t} x(τ) dτ \xrightarrow{ℱ} Y(jΩ) = \frac{X(jΩ)}{jΩ}  \tag{4}
$$

取一个微元增量 $Δt$ 则有

$$
y(t+Δt) = \int\nolimits_{-∞}^{t+Δt} x(τ) dτ 
        = \int\nolimits_{-∞}^{t} x(τ) dτ + \int\nolimits_{t}^{t+Δt} x(τ) dτ 
        ≈ y(t) + \frac{x(t) + x(t+Δt)}{2}Δt  \tag{5}
$$

由于微元面积的计算跟梯形面积的计算方式相同，这被称为**梯形积分**法，并且采样间隔越小或者采样率越高，上式的精度越高。将上式离散化后**近似**有

$$
y[k] = y[k-1] + (x[k-1] + x[k]) \frac{Δt}{2}  \tag{6}
$$

取其 $z$ 变换有

$$
Y[z] = z^{-1} Y[z]  + (z^{-1}X[z] + X[z]) \frac{Δt}{2}  \tag{7}
$$

即可得其传递函数

$$
H[z] = \frac{Y[z]}{X[z]} = \frac{1 + z^{-1}}{1 - z^{-1}} \frac{Δt}{2}  \tag{8}
$$

再结合模拟变换域的积分性质得

$$
H(jΩ) = \frac{Y(jΩ)}{X(jΩ)} = \frac{1}{jΩ}  \tag{9}
$$

式(8), (9)是等价的，即

$$
\frac{1}{jΩ} = \frac{1 + z^{-1}}{1 - z^{-1}} \frac{Δt}{2}  \tag{10}
$$

如此得到变换域公式

$$
s = \frac{2}{Δt}  \frac{1 - z^{-1}}{1 + z^{-1}}  \tag{11}
$$

由于分子分母都是线性的，故称为双线性变换法，即

$$
\color{blue}  H(s) \xrightarrow{\footnotesize s = \frac{2}{Δt} (1 - z^{-1})/(1 + z^{-1})} H[z]  \tag{12}
$$

再看看它的逆变换

$$
z = \frac{2/Δt + s}{2/Δt - s}  \tag{13}
$$

不难得到

$$
|z| = \frac{|2/Δt + s|}{|2/Δt - s|} = 1  \tag{14}
$$

即虚轴被映射到了 $z$ 平面的单位圆上。将公式 (11) 进一步变换为

$$
jΩ = \frac{2}{Δt} \frac{1 - e^{-jω}}{1 + e^{-jω}} 
   = \frac{2}{Δt} \frac{e^{jω/2} - e^{-jω/2}}{e^{jω/2} + e^{-jω/2}}
   = j \frac{2}{Δt} tan(\frac{ω}{2})  \tag{15}
$$

即模拟角频率 $Ω ∈ [0,∞)$ 与数字角频率 $Ω ∈ [0,π)$ 的关系为

$$
\color{blue} Ω = \frac{2}{Δt} tan(\frac{ω}{2})  \tag{16}
$$

用正常的频率单位赫兹来表述即

$$
f_Ω = \frac{f_s}{π} tan(π \frac{f_ω}{f_s})  \tag{17}
$$

其中 $f_Ω$ 表示模拟域频率，$f_ω$ 表示数字域频率 ，$f_s$为采样率。需要注意的是，虽然是频响是一对一映射的，但是从频率转换公式上可以看出这是一种**非线性映射**，其仅在低频段表现出线性。因此在设计数字滤波器时，应该先用公式（16）或（17）进行频率**预矫正**。例如，当采样率为 $\rm 16kHz$ 时，数字域内的 $\rm 1kHz$ 截止频率对应模拟域内的截止频率为 $\frac{16000}{π} \rm tan(π \frac{1000}{16000}) ≈ 1013  \rm Hz $ 。

## 脉冲响应不变法

此法是比较直接的，其大致步骤为：

$$
\footnotesize H(s) \xrightarrow{\rm Laplace 逆变换} 连续单位脉冲响应 h_a(t) \xrightarrow{采样} 离散单位脉冲响应 h[n] \xrightarrow{z变换} H[z]
$$

## 附录

### A 矩形积分变换法

对公式（5）的近似上采用了**精度较高的梯形积分法**，如果采用**精度稍差点的矩形积分法**则得到两种方式

$$
y(t+Δt) ≈ y(t) + x(t)Δt  \tag{A-1}
$$

$$
y(t+Δt) ≈ y(t) + x(t+Δt)Δt  \tag{A-2}
$$

离散化后，分别近似对应

$$
y[k] = y[k-1] + x[k-1]Δt  \tag{A-3}
$$

$$
y[k] = y[k-1] + x[k]Δt  \tag{A-4}
$$

经过 $z$ 变换后，即得两种映射方案

$$
\large H(s) \xrightarrow{\large s = \frac{1}{Δt} (1 - z^{-1})/z^{-1}} H[z]  \tag{A-5}
$$

$$
\large H(s) \xrightarrow{\large s = \frac{1}{Δt}(1 - z^{-1})} H[z]  \tag{A-6}
$$

对应的频率映射分别为

$$
jΩ = \frac{1}{Δt} \frac{1 - e^{-jω}}{e^{-jω}} 
   ≈ \frac{jω}{Δt}  \tag{A-7}
$$

$$
jΩ = \frac{1}{Δt} \frac{1 - e^{-jω}}{1} 
   ≈ \frac{jω}{Δt}  \tag{A-8}
$$

这与公式（16）不谋而合，即在略低的频带上

$$
Ω = \frac{2}{Δt} tan(\frac{ω}{2}) ≈ \frac{ω}{Δt} \tag{A-9}
$$
