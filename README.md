# IIR 滤波器设计

## 1、简言

滤波器是能对信号的频率分量进行修正的系统，在连续系统中称之为**模拟滤波器**，例如电阻、电容与电感组成的基本电路，而在离散系统中则称之为**数字滤波器**，例如 FIR 与 IIR 滤波器。在一些存储、计算资源有限，或者实时性要求很高的场景，IIR 滤波器一般是首选，而对非线性相位失真敏感的场景则可以使用 FIR 滤波器。设计数字滤波器的方法有多种，大体思路有两类，即分别从时域、频域角度去设计。

### 1.1 频域设计法

使**数字**滤波器的系统频响 $H[z]$ 为其对应的**模拟**滤波器的系统频响 $H(s)$ 的**逼近**, 此法具体操作方向有：

+ $ \small 模拟低通 \xrightarrow{频率变换} 模拟目标类型 \xrightarrow{域变换} 数字目标类型 $
+ $ \small 模拟低通 \xrightarrow{域变换} 数字低通 \xrightarrow{频率变换} 数字目标类型 $
+ $ \small 模拟低通 \xrightarrow{频率变换+域变换} 数字目标类型 $

对于阶数较低的滤波器（例如双二阶类型），很容易写出典型的几种滤波器的表达式，因此可以直接考虑用如下操作方法：

$$
\small 模拟目标类型 \ H_{ftype}(s) \xrightarrow{\ 域变换 \ } 数字目标类型 \ H_{ftype}[z]
$$

常用的一种**域变换**方法为**双线性变换法**。

### 1.2 时域设计法

使**数字**滤波器的单位脉冲响 $h[n]$ 为其对应的**模拟**滤波器的单位脉冲响应 $h(t)$ 的采样, 此法一般使用**脉冲响应不变法**或者**阶跃响应不变法**。

## 2. 双线性变换法

在变换域设计法中，如果能找到将 $s$ 域转换到 $z$ 域的方法，那么便可以将**同种类型的**滤波器从模拟域变换到数字域。可以尝试从模拟域中找到一个几乎只含有 $s$ 的简单变换式。查阅傅里叶变换和拉普拉斯变换这两个经典变换域中的众多性质（线性、平移、反转、尺度、卷积、微分、积分等），可以发现微分和积分性质中含有较为单独的域变量， 下面将在长时**因果稳定**系统中（长时因果，即考虑从遥远的过去 $-∞$ 到现在 $t$）, 分别讨论这两个变换域中的积分特性。

+ 傅里叶变换域
  令 $s=jΩ$，考虑傅里叶变换 $ℱ$ 的积分特性，若有傅里叶变换对

  $$
  x(t) \xrightarrow{ℱ} X(jΩ)  \tag{1-a}
  $$

  则原函数的积分对应的傅里叶变换对为

  $$
  \int\nolimits_{-∞}^{t} x(τ) \ dτ \xrightarrow{ℱ} X(jΩ) \ (\frac{1}{jΩ} + πδ(Ω))  \tag{2-a}
  $$

  若无直流分量，即有

  $$
  \int\nolimits_{-∞}^{t} x(τ) \ dτ \xrightarrow{ℱ} \frac{X(jΩ)}{jΩ}  \tag{3-a}
  $$
+ 拉普拉斯变换域
  在单边拉氏变换域中，也可以得到与傅氏变换域一致的结论，设

  $$
  x(t) \xrightarrow{ℒ} X(s)  \tag{1-b}
  $$

  则原函数的积分对应的拉氏变换对为

  $$
  \int\nolimits_{-∞}^{t} x(τ) \ dτ \xrightarrow{ℒ} \frac{X(s)+\int\nolimits_{-∞}^{0}f(τ) \ dτ}{s} \tag{2-b}
  $$

  无初始状态时（即无历史累积量）有

  $$
  \int\nolimits_{-∞}^{t} x(τ) \ dτ \xrightarrow{ℒ} \frac{X(s)}{s}  \tag{3-b}
  $$

可以看出，从两个变换域都可以导出相同的算子形式。至此，只含 $s$ 的关系式有了，而积分又如何跟离散域取得联系呢？这里容易想到的是积分里的微元法，可以将积分写为

$$
y(t) = \int\nolimits_{-∞}^{t} x(τ) \ dτ  \tag{4}
$$

取一个微元增量 $Δt$ 则有

$$
\begin{align*}
y(t+Δt) &= \int\nolimits_{-∞}^{t+Δt} x(τ) \ dτ \\
        &= {\color{olive}\int\nolimits_{-∞}^{t} x(τ) \ dτ} + {\color{purple}\int\nolimits_{t}^{t+Δt} x(τ) \ dτ} \\
        &≈ {\color{olive}y(t)} + {\color{purple}\frac{x(t) + x(t+Δt)}{2}Δt}  \tag{5}
\end{align*}
$$

这里微元面积的计算跟梯形面积的计算方式相同，因此这也被称为**梯形积分**法，并且间隔 $Δt$ 越小，上式中近似部分的精度越高。将上式离散化后**近似**有

$$
y[k] = y[k-1] + ( x[k-1] + x[k]) \frac{Δt}{2}  \tag{6}
$$

取其 $z$ 变换有

$$
Y[z] = z^{-1} Y[z]  + (z^{-1}X[z] + X[z]) \frac{Δt}{2}  \tag{7}
$$

即可得其传递函数

$$
H[z] = \frac{Y[z]}{X[z]} = \frac{1 + z^{-1}}{1 - z^{-1}} \frac{Δt}{2}  \tag{8}
$$

再结合模拟变换域的积分性质得

$$
H(s) = \frac{Y(s)}{X(s)} = \frac{1}{s}  \tag{9}
$$

式(8), (9)是等价的，即

$$
\frac{1}{s} = \frac{1 + z^{-1}}{1 - z^{-1}} \frac{Δt}{2}  \tag{10}
$$

如此得到变换公式

$$
s = \frac{2}{Δt} \frac{1 - z^{-1}}{1 + z^{-1}} 
  = \frac{2}{Δt} \frac{z - 1}{z + 1} \tag{11}
$$

由于分子分母都是线性的，故称为双线性变换法，即

$$
\color{blue}  H(s) \xrightarrow{\small s = \frac{2}{Δt} (z - 1)/(z + 1)} H[z]  \tag{12}
$$

再看看它的逆变换

$$
z = \frac{2/Δt + s}{2/Δt - s}  \tag{13}
$$

当 $s=jΩ$ 时，不难得到

$$
|z| = \frac{|2/Δt + jΩ|}{|2/Δt - jΩ|} = 1  \tag{14}
$$

即**虚轴**被映射到了 $z$ 平面的单位**圆上**。另外，不难验证：

+ 当 ${\rm Real}(s)>0$ 时 $|z|>1$，即 $s$ **右**半平面被映射在了 $z$ 平面的单位**圆外**
+ 当 ${\rm Real}(s)<0$ 时 $|z|<1$，即 $s$ **左**半平面被映射在了 $z$ 平面的单位**圆内**

这表明，如果模拟滤波器的极点、零点如果处在 $s$ 域的左半平面，那么变换之后则处于 $z$ 域的单位圆之内，即滤波器的稳定性和最小相位性是一致的。形象化的展示见下图。

<div align=center> <img src=images/s2z.png> </div>

在虚轴上，令 $z={\rm e}^{\ jω}$，将公式 (11) 进一步变换为

$$
jΩ = \frac{2}{Δt} \frac{1 - {\rm e}^{-jω}}{1 + {\rm e}^{-jω}} 
   = \frac{2}{Δt} \frac{{\rm e}^{\ jω/2} - {\rm e}^{-jω/2}}{{\rm e}^{\ jω/2} + {\rm e}^{-jω/2}}
   = j \frac{2}{Δt} {\rm tan}(\frac{ω}{2}) \tag{15}
$$

即模拟角频率 $Ω ∈ [0,∞)$ 与数字圆周角频率 $ω ∈ [0,π)$ 的映射关系为

$$
\color{blue} Ω = \frac{2}{Δt} {\rm tan}(\frac{ω}{2})  \tag{16-a}
$$

或者用正常物理意义的角频率 $ɷ = ω f_s = ω/T_s$ 有

$$
Ω = \frac{2}{Δt} {\rm tan}(\frac{ɷ}{2f_s})
  = \frac{2}{Δt} {\rm tan}(\frac{T_s}{2}ɷ)  \tag{16-b}
$$

其中 $f_s$ 为采样率, $T_s$ 为采样间隔。若数字化的采样间隔 $1/f_s$ 跟近似积分间隔 $Δt$ 相同，则用正常的频率单位**赫兹**来表述（16）式，即得

$$
f_Ω = \frac{f_s}{π} {\rm tan}(π \frac{f_ω}{f_s})  \tag{17}
$$

其中 $f_Ω ∈ [0,∞)$ 表示模拟域频率，$f_ω ∈ [0,f_s/2)$ 表示数字域频率，二者物理意义相同，下标仅用于区分使用场景。需要注意的是，虽然频响是一对一映射的，但是从频率转换公式上可以看出这是一种**非线性映射**，其仅在低频段表现出较强的线性。因此在设计数字滤波器时，应该先用公式（16）或（17）进行频率**预矫正**。例如，当采样率为 $\rm 16kHz$ 时，数字域内的 $\rm 1kHz$ 截止频率对应模拟域内的截止频率为 $\frac{16000}{π} \rm tan(π \frac{1000}{16000}) ≈ 1013 \rm Hz $ 。

倘若我们不要求 $1/f_s=Δt$ 时，而只要求模拟频率跟数字频率一一对应时，那么可以通过如下变换实现

$$
s = \frac{Ω_c}{{\rm tan}(\frac{ɷ_c}{2f_s})} \frac{z - 1}{z + 1} \tag{18}
$$

这表明可以将任意特征频率 $Ω_c$ 的模拟滤波器直接映射到任意特征频率 $ɷ_c$ 的数字滤波器。若二者特征频率一样则

$$
s = \frac{ɷ_c}{{\rm tan}(\frac{ɷ_c}{2f_s})} \frac{z - 1}{z + 1} \tag{19}
$$

有时候为了化简方便，还会直接将模拟截止频率设置为一。总之，积分间隔的设置有很大的灵活性，这为某些双线性变换时的化简工作带来了极大的便利。


## 3. 脉冲响应不变法

此法是比较直接的，其大致步骤为：

$$
H(s) \xrightarrow{\rm Laplace 逆变换} h(t) \xrightarrow{采样}  h[n] \xrightarrow{z变换} H[z]
$$

这个方法**可能存在**频域**混叠干扰**的现象。这里可以具体比较其两个变换域，挖掘其映射特性。

$$
h(t) \xrightarrow{ℒ} H(s)  \\
h[n] \xrightarrow{ℒ} H'(s) \\
h[n] \xrightarrow{z} H[z]
$$

已知**规整化**的采样间隔为 $T_s = 2π / Ω_s$ 的采样序列的傅里叶级数展开为

$$
T_s \sum\limits_{n=-∞}^{∞}δ(t-n T_s) = \sum\limits_{k=-∞}^{∞} {\rm e}^{\ jk\ Ω_s t}, \  t ∈ 𝐑
$$

取其右侧区间得

$$
T_s \sum\limits_{n=0}^{∞}δ(t-n T_s) = \sum\limits_{k=-∞}^{∞} {\rm e}^{\ jk\ Ω_s t}, \  t≥0
$$

然后利用采样序列，可以得到采样后的信号（数字信号）的单边拉氏变换为

$$
\begin{align*}
h[n] \xrightarrow{ℒ}
H'(s) &= \int \nolimits_{0}^{∞} h(t) \left(T_s\sum\limits_{n=0}^{∞}δ(t-nT_s)\right) {\rm e}^{-st} dt \\
      &= \int \nolimits_{0}^{∞} h(t) \left(\sum \limits_{k=-∞}^{∞} {\rm e}^{\ jk\ Ω_st} \right) {\rm e}^{-st} dt \\
      &= \sum \limits_{k=-∞}^{∞} \left(\int\nolimits_{0}^{∞} h(t) {\rm e}^{-(s-jk\ Ω_s)t} dt \right)\\
      &= \sum \limits_{k=-∞}^{∞} H(s-jk\ Ω_s)
\end{align*}
$$

简言之，数字信号 $h[n]$ 的拉氏变换 $ H'(s)$ 为其对应的模拟信号 $h(t)$ 的拉氏变换 $H(s)$ 在虚轴方向的**周期延拓**，如果 $h(t)$ 是严格带限在 $[-Ω_s/2,\ Ω_s/2)$ 内的信号（可用低通滤波器实现），那么在周期延拓时才不会产生混叠干扰。此外，提高采样率也是一个减少失真的方法，或者高频部分的信号衰减很快，则可以忽略混叠失真。

再比较下数字信号在 $s$ 域与 $z$ 域的响应，一方面数字信号 $h[n]$ 的单边拉氏变换为

$$
\begin{align*}
h[n] \xrightarrow{ℒ}
H'(s) &= \int \nolimits_{0}^{∞} h(t) \left(T_s\sum\limits_{n=0}^{∞}δ(t - n T_s)\right) {\rm e}^{-st} dt \\
      &= \sum \limits_{n=0}^{∞} \left(\int\nolimits_{0}^{∞} h(n T_s) \ {\rm e}^{-sn T_s} \ δ(t - n T_s) dt \right) \\
      &= \sum \limits_{n=0}^{∞} h(n T_s) \ {\rm e}^{-sn T_s} \left(\int\nolimits_{0}^{∞} δ(t - n T_s) dt \right) \\
      &= \sum \limits_{n=0}^{∞} h[n] \ {\rm e}^{-sn T_s}
\end{align*}
$$

另一方面数字信号 $h[n]$ 的 $z$ 变换为

$$
h[n] \xrightarrow{z} H[z] = \sum \limits_{n=0}^{∞} h[n] \ z^{-n}
$$

此处 $ H'(s)$ 与 $H[z]$ 应该是等价的，即 $z = {\rm e}^{\ s \ T_s}$ 。在 $s$ 虚轴上亦可得 ${\rm e}^{\ jω} = {\rm e}^{\ jΩ \ T_s}$ ，即得 $Ω = ω/\ T_s$。这表明在脉冲响应不变法中，模拟频率到数字频率的转换满足**线性关系**，这是双线性变换法无法比拟的优点。简言之，如果可以避免或忽略混叠失真的话，那么此法能极大地保留模拟滤波器的特性，比如较好的瞬态响应性。

## 附录

### A 矩形积分变换法

对公式（5）的近似上采用了**精度较高的梯形积分法**，如果采用**精度稍差点的矩形积分法**则得到两种方式

$$
y(t+Δt) ≈ y(t) + x(t)Δt  \tag{A-1}
$$

$$
y(t+Δt) ≈ y(t) + x(t+Δt)Δt  \tag{A-2}
$$

离散化后，分别近似对应

$$
y[k] = y[k-1] + x[k-1]Δt  \tag{A-3}
$$

$$
y[k] = y[k-1] + x[k]Δt  \tag{A-4}
$$

经过 $z$ 变换后，即得两种映射方案

$$
\large H(s) \xrightarrow{\large s = \frac{1}{Δt} (1 - z^{-1})/z^{-1}} H[z]  \tag{A-5}
$$

$$
\large H(s) \xrightarrow{\large s = \frac{1}{Δt}(1 - z^{-1})} H[z]  \tag{A-6}
$$

对应的频率映射分别为

$$
jΩ = \frac{1}{Δt} \frac{1 - {\rm e}^{-jω}}{{\rm e}^{-jω}} 
   ≈ \frac{jω}{Δt}  \tag{A-7}
$$

$$
jΩ = \frac{1}{Δt} \frac{1 - {\rm e}^{-jω}}{1} 
   ≈ \frac{jω}{Δt}  \tag{A-8}
$$

这与公式（16）不谋而合，即在略低的频带上

$$
Ω = \frac{2}{Δt} {\rm tan}(\frac{ω}{2}) ≈ \frac{ω}{Δt} \tag{A-9}
$$

这表明在**低频带上**可以用简化版的（A-5）跟（A-6）来进行域变换，尤其是（A-6）更简洁，可以简化推导过程。接下来不妨分析下其稳定性，由 $s = \frac{1}{Δt}(1 - z^{-1})$ 得到

$$
z = \frac{1}{(1-s \ Δt)} = \frac{\frac{1}{2}(1 - s \ Δt) + \frac{1}{2}(1 + s \ Δt)}{(1-s \ Δt)}
$$

即有

$$
z - \frac{1}{2} = \frac{1}{2} \frac{(1 + s \ Δt)}{(1-s \ Δt)}
$$

与双线性变换分析类似，可以得出 $s$ 的**虚轴**被映射在了 $z$ 平面的一个**圆上**，此圆记为 $C$ ，其圆心在 $z = 0.5$ 处，半径也为 $0.5$。即满足

$$
|z - 0.5| = 0.5
$$

另外，不难验证：

+ 当 ${\rm Real}(s)>0$ 时 $|z-0.5|>0.5$，即 $s$ **右**半平面被映射在了 $z$ 平面的 $C$ **外**
+ 当 ${\rm Real}(s)<0$ 时 $|z-0.5|<0.5$，即 $s$ **左**半平面被映射在了 $z$ 平面的 $C$ **内**

这意味着，极点都被囚禁在单位圆的右侧，因此不可能将模拟高通滤波器映射到数字高通滤波器。


